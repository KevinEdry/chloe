import { Callout } from 'nextra/components'

export const metadata = {
  title: 'Worktree',
  description: 'Manage Git worktrees and Jujutsu workspaces in Chloe. Work on multiple branches simultaneously, open worktrees in your IDE, and handle merge operations with Claude assistance.',
  keywords: ['Chloe worktree', 'git worktrees', 'jujutsu workspaces', 'parallel branches', 'git management', 'jujutsu management', 'branch workflow'],
  alternates: { canonical: '/docs/worktree' },
}

# Worktree

The Worktree tab displays and manages Git worktrees or Jujutsu workspaces in your repository, enabling parallel development on multiple branches.

![Worktree navigation](/docs/worktree-navigate.gif)

## What are Worktrees/Workspaces?

**Git Worktrees** and **Jujutsu Workspaces** both allow you to have multiple working directories from a single repository. Each worktree/workspace can be on a different branch, enabling you to:

- Work on multiple features simultaneously
- Keep your main branch clean while experimenting
- Isolate Claude's work from your main codebase

<Callout type="info">
When you start a task in Chloe, it can automatically create a worktree (Git) or workspace (Jujutsu) for isolated development. Chloe uses the terminology based on your configured version control system in Settings.
</Callout>

### Choosing Your Version Control System

Chloe supports both Git and Jujutsu:

- **Git**: Uses traditional worktrees with branches
- **Jujutsu (jj)**: Uses workspaces with Jujutsu's next-generation version control

Configure your preference in **Settings → Shell & Terminal → Version Control**. The UI will automatically adapt terminology:
- Git: "Worktree", "Branch"
- Jujutsu: "Workspace", "Workspace Name"

## Worktree/Workspace List

The tab displays all worktrees (Git) or workspaces (Jujutsu) in your repository:

| Column | Description |
|--------|-------------|
| **Path** | Directory location of the worktree/workspace |
| **Branch/Name** | Which branch (Git) or workspace name (Jujutsu) is being tracked |
| **Status** | Indicators for bare/detached state (Git only) |


## Auto-Refresh

The list automatically refreshes every 2 seconds when the tab is visible, so you'll see new worktrees/workspaces appear as Claude creates them.

## Opening Worktrees/Workspaces

Press `o` on a selected worktree/workspace to open it:

- Opens in your configured IDE
- Opens a terminal at the worktree/workspace path

![Opening worktree](/docs/worktree-open.gif)

## Deleting Worktrees/Workspaces

Press `d` to delete a worktree/workspace:

1. A confirmation dialog appears
2. Press `y` to confirm or `n` to cancel
3. The worktree/workspace is removed:
   - **Git**: Removes the worktree directory and deletes the branch
   - **Jujutsu**: Forgets the workspace and removes the directory

<Callout type="warning">
Deleting a worktree/workspace removes its directory. Make sure any changes are committed or merged first.
</Callout>

## Task Integration

Tasks can be linked to worktrees/workspaces through the `WorktreeInfo` field:

- **Branch/Workspace Name**: The branch (Git) or workspace (Jujutsu) being worked on
- **Path**: Location of the worktree/workspace

When reviewing a task, you can:
- Open the worktree/workspace in your IDE
- Merge the changes to main (Git only currently)
- Resolve conflicts if they occur

## Merge Operations

<Callout type="info">
Merge operations are currently only supported for Git worktrees. Jujutsu workspace merging will be added in a future release.
</Callout>

From the Tasks tab review popup, you can merge worktree changes (Git only):

1. Select "Merge to Branch" in the review popup
2. Chloe attempts to merge the worktree branch to main
3. If conflicts are detected, the option changes to "Resolve Conflicts"
4. Claude is prompted to fix any merge conflicts


## Keybindings

| Key | Action |
|-----|--------|
| `j` / `↓` | Select next worktree/workspace |
| `k` / `↑` | Select previous worktree/workspace |
| `d` | Delete worktree/workspace |
| `o` | Open in IDE/terminal |
| `r` | Refresh list |

## Repository Detection

Chloe automatically detects the repository root and lists all worktrees (Git) or workspaces (Jujutsu). If you're not in a repository, an error message is displayed.

## Worktree/Workspace Properties

| Property | Description |
|----------|-------------|
| **Path** | Absolute path to the worktree/workspace directory |
| **Branch/Workspace Name** | The branch (Git) or workspace name (Jujutsu) |
| **Is Bare** | Whether this is a bare repository (Git only) |
| **Is Detached** | Whether HEAD is detached (Git only) |
| **Auto Created** | Whether Chloe created this worktree/workspace |

<Callout>
Worktrees/workspaces created by Chloe are marked as "Auto Created" and can be safely cleaned up after merging or when the task is complete.
</Callout>

## Implementation Details

### Git Worktrees
- Creates worktrees using `git worktree add -b <branch-name>`
- Branch naming: `chloe/<task-slug>`
- Stored in `.chloe/worktrees/<branch-name>/`
- Cleanup: `git worktree remove` + branch deletion

### Jujutsu Workspaces
- Creates workspaces using `jj workspace add --name <name>`
- Workspace naming: `chloe-<task-slug>-<short-id>`
- Stored in `.chloe/workspaces/<workspace-name>/`
- Cleanup: `jj workspace forget` + directory removal
